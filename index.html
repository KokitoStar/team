<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Kokito</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: url('motivos/FONDO.png') center center;
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
        }

        .system-overlay {
            background: rgba(0, 0, 0, 0.8);
            min-height: 100vh;
        }

        .login-background {
            background: url('motivos/FONDO.png') center center;
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
        }

        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 11px;
            max-width: 350px;
            z-index: 1000;
            border: 2px solid #10b981;
            max-height: 70vh;
            overflow-y: auto;
        }

        .user-credentials {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Iconos simples usando texto/emojis
        const Icons = {
            User: () => <span className="text-xl">ğŸ‘¤</span>,
            UserPlus: () => <span className="text-xl">ğŸ‘¥</span>,
            Package: () => <span className="text-xl">ğŸ“¦</span>,
            TrendingUp: () => <span className="text-xl">ğŸ“ˆ</span>,
            LogOut: () => <span className="text-xl">ğŸšª</span>,
            Settings: () => <span className="text-xl">âš™ï¸</span>,
            Eye: () => <span className="text-lg">ğŸ‘ï¸</span>,
            EyeOff: () => <span className="text-lg">ğŸ™ˆ</span>,
            Edit: () => <span className="text-lg">âœï¸</span>,
            Save: () => <span className="text-lg">ğŸ’¾</span>,
            Cancel: () => <span className="text-lg">âŒ</span>,
            Copy: () => <span className="text-lg">ğŸ“‹</span>
        };

        // ConfiguraciÃ³n para almacenamiento en la nube
        // INSTRUCCIONES: 
        // 1. Ve a https://jsonbin.io y crea una cuenta gratuita
        // 2. Crea un nuevo bin y copia el ID (despuÃ©s de /b/ en la URL)
        // 3. Ve a API Keys y crea una nueva clave
        // 4. Reemplaza los valores a continuaciÃ³n:
        
        const CLOUD_STORAGE_URL = 'https://api.jsonbin.io/v3/b/683e8d5d8960c979a5a49ccd';
        const API_KEY = '$2a$10$L/MnHsnfro1BCzog6tn5yORzXA3sNIG3Y/qVSeMOv9hWjyZ3mmmZq';
        
        // Para probar sin configurar, el sistema usarÃ¡ localStorage como fallback
        const CLOUD_ENABLED = false; // Cambiar de true a false
        
        // Sistema de almacenamiento hÃ­brido con sincronizaciÃ³n en la nube
        const STORAGE_KEY = 'kokito_users_v3';
        
        // FunciÃ³n para obtener usuarios desde la nube
        const fetchUsersFromCloud = async () => {
            if (!CLOUD_ENABLED) {
                console.log('â˜ï¸ Almacenamiento en la nube no configurado, usando localStorage');
                return null;
            }
            
            try {
                console.log('â˜ï¸ Obteniendo usuarios desde la nube...');
                const response = await fetch(CLOUD_STORAGE_URL + '/latest', {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': API_KEY,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.record && data.record.users) {
                        console.log('â˜ï¸ Usuarios obtenidos desde la nube:', data.record.users);
                        return data.record.users;
                    }
                }
            } catch (error) {
                console.warn('âš ï¸ Error obteniendo datos de la nube:', error.message);
            }
            return null;
        };
        
        // FunciÃ³n para guardar usuarios en la nube
        const saveUsersToCloud = async (usersList) => {
            if (!CLOUD_ENABLED) {
                console.log('â˜ï¸ Almacenamiento en la nube no configurado, solo guardando localmente');
                return true; // Simular Ã©xito para localStorage
            }
            
            try {
                console.log('â˜ï¸ Guardando usuarios en la nube...');
                const response = await fetch(CLOUD_STORAGE_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY
                    },
                    body: JSON.stringify({
                        users: usersList,
                        lastUpdated: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    console.log('â˜ï¸ Usuarios guardados en la nube exitosamente');
                    return true;
                } else {
                    console.error('âŒ Error guardando en la nube:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('âŒ Error conectando con la nube:', error.message);
                return false;
            }
        };
        
        // FunciÃ³n para obtener usuarios con fallback en mÃºltiples niveles
        const getStoredUsers = async () => {
            // 1. Intentar obtener desde la nube primero
            const cloudUsers = await fetchUsersFromCloud();
            if (cloudUsers && cloudUsers.length > 0) {
                // Guardar en localStorage como cache
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(cloudUsers));
                } catch (error) {
                    console.warn('âš ï¸ No se pudo guardar cache local:', error.message);
                }
                window.kokitoUsers = cloudUsers;
                return cloudUsers;
            }
            
            // 2. Fallback a localStorage
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    console.log('ğŸ“ Usuarios cargados desde localStorage:', parsed);
                    window.kokitoUsers = parsed;
                    return parsed;
                }
            } catch (error) {
                console.warn('âš ï¸ localStorage no disponible:', error.message);
            }
            
            // 3. Fallback a variable global
            if (window.kokitoUsers && window.kokitoUsers.length > 0) {
                console.log('ğŸ“ Usuarios cargados desde variable global:', window.kokitoUsers);
                return window.kokitoUsers;
            }
            
            // 4. Usuarios por defecto
            const defaultUsers = [
                {
                    id: 1,
                    username: 'estebango001@gmail.com',
                    password: '8357565Jj.',
                    role: 'admin',
                    name: 'Esteban GÃ³mez',
                    phone: '3218526763',
                    active: true,
                    createdAt: new Date().toISOString()
                }
            ];
            console.log('ğŸ“ Usando usuarios por defecto:', defaultUsers);
            
            // Guardar usuarios por defecto en la nube
            await saveUsersToCloud(defaultUsers);
            
            return defaultUsers;
        };
        
        // FunciÃ³n para guardar usuarios con mÃºltiples mÃ©todos incluyendo la nube
        const saveUsersToStorage = async (usersList) => {
            // 1. Guardar en la nube (prioridad)
            const cloudSaved = await saveUsersToCloud(usersList);
            
            // 2. Guardar en localStorage como cache
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(usersList));
                console.log('ğŸ’¾ Usuarios guardados en localStorage');
            } catch (error) {
                console.warn('âš ï¸ No se pudo guardar en localStorage:', error.message);
            }
            
            // 3. Siempre guardar en variable global
            window.kokitoUsers = usersList;
            console.log('ğŸ’¾ Usuarios guardados en variable global');
            
            // 4. Disparar evento para sincronizaciÃ³n entre pestaÃ±as
            try {
                window.dispatchEvent(new CustomEvent('kokito_users_updated', { 
                    detail: { users: usersList, timestamp: Date.now(), cloudSaved } 
                }));
                console.log('ğŸ“¡ Evento de sincronizaciÃ³n disparado');
            } catch (error) {
                console.warn('âš ï¸ No se pudo disparar evento:', error.message);
            }
            
            return cloudSaved;
        };

        const KokitoSystem = () => {
          // Estados principales
          const [currentUser, setCurrentUser] = useState(null);
          const [showPassword, setShowPassword] = useState(false);
          const [loginForm, setLoginForm] = useState({ username: '', password: '' });
          const [users, setUsers] = useState([]);
          const [debugMode, setDebugMode] = useState(false);
          const [loginAttempts, setLoginAttempts] = useState([]);
          const [lastSync, setLastSync] = useState(Date.now());
          const [isLoading, setIsLoading] = useState(true);
          const [cloudStatus, setCloudStatus] = useState('conectando');
          
          // Cargar usuarios al inicio
          useEffect(() => {
            const loadInitialUsers = async () => {
              setIsLoading(true);
              setCloudStatus('conectando');
              try {
                const loadedUsers = await getStoredUsers();
                setUsers(loadedUsers);
                setCloudStatus('conectado');
                console.log('âœ… Usuarios iniciales cargados:', loadedUsers.length);
              } catch (error) {
                console.error('âŒ Error cargando usuarios iniciales:', error);
                setCloudStatus('error');
                // Fallback a usuarios por defecto
                const defaultUsers = [
                  {
                    id: 1,
                    username: 'estebango001@gmail.com',
                    password: '8357565Jj.',
                    role: 'admin',
                    name: 'Esteban GÃ³mez',
                    phone: '3218526763',
                    active: true,
                    createdAt: new Date().toISOString()
                  }
                ];
                setUsers(defaultUsers);
              } finally {
                setIsLoading(false);
              }
            };
            
            loadInitialUsers();
          }, []);
          
          // SincronizaciÃ³n automÃ¡tica y escucha de eventos entre pestaÃ±as
          useEffect(() => {
            // FunciÃ³n para manejar sincronizaciÃ³n entre pestaÃ±as
            const handleStorageSync = (event) => {
              if (event.detail && event.detail.users && event.detail.timestamp > lastSync) {
                console.log('ğŸ“¡ Sincronizando usuarios desde otra pestaÃ±a:', event.detail.users);
                setUsers(event.detail.users);
                setLastSync(event.detail.timestamp);
                if (event.detail.cloudSaved) {
                  setCloudStatus('conectado');
                }
              }
            };
            
            // Escuchar eventos de sincronizaciÃ³n
            window.addEventListener('kokito_users_updated', handleStorageSync);
            
            // Verificar la nube periÃ³dicamente (cada 10 segundos)
            const syncInterval = setInterval(async () => {
              try {
                const cloudUsers = await fetchUsersFromCloud();
                if (cloudUsers && JSON.stringify(cloudUsers) !== JSON.stringify(users)) {
                  console.log('ğŸ”„ Detectado cambio en la nube, sincronizando...');
                  setUsers(cloudUsers);
                  setCloudStatus('conectado');
                }
              } catch (error) {
                console.warn('âš ï¸ Error verificando la nube:', error.message);
                setCloudStatus('error');
              }
            }, 10000);
            
            return () => {
              window.removeEventListener('kokito_users_updated', handleStorageSync);
              clearInterval(syncInterval);
            };
          }, [users, lastSync]);

          // Estado para crear nuevo usuario
          const [newUser, setNewUser] = useState({
            username: '',
            password: '',
            name: '',
            phone: ''
          });
          
          const [showCreateForm, setShowCreateForm] = useState(false);
          const [loginError, setLoginError] = useState('');
          const [editingUser, setEditingUser] = useState(null);
          const [lastCreatedUser, setLastCreatedUser] = useState(null);

          // FunciÃ³n de login con sincronizaciÃ³n en tiempo real desde la nube
          const handleLogin = async () => {
            const attemptTime = new Date().toLocaleTimeString();
            
            if (!loginForm.username || !loginForm.password) {
              setLoginError('Por favor ingresa usuario y contraseÃ±a');
              return;
            }
            
            setIsLoading(true);
            setCloudStatus('verificando');
            
            try {
              // Obtener usuarios mÃ¡s recientes de la nube
              const currentUsers = await getStoredUsers();
              
              console.log(`ğŸ” [${attemptTime}] Intento de login:`, {
                username: loginForm.username,
                password: '***',
                totalUsers: currentUsers.length,
                source: 'nube'
              });
              
              console.log('ğŸ‘¥ Usuarios disponibles para login:', currentUsers.map(u => ({
                id: u.id,
                username: u.username,
                active: u.active,
                role: u.role,
                name: u.name,
                createdAt: u.createdAt
              })));
              
              // Buscar usuario - comparaciÃ³n exacta primero, luego case insensitive
              let user = currentUsers.find(u => 
                u.username === loginForm.username && 
                u.password === loginForm.password &&
                u.active
              );
              
              if (!user) {
                // Intentar con case insensitive
                user = currentUsers.find(u => 
                  u.username.toLowerCase() === loginForm.username.toLowerCase() && 
                  u.password === loginForm.password &&
                  u.active
                );
              }
              
              const attempt = {
                time: attemptTime,
                username: loginForm.username,
                success: !!user,
                userFound: !!currentUsers.find(u => u.username.toLowerCase() === loginForm.username.toLowerCase()),
                activeUser: !!currentUsers.find(u => u.username.toLowerCase() === loginForm.username.toLowerCase() && u.active),
                passwordMatch: !!currentUsers.find(u => u.username.toLowerCase() === loginForm.username.toLowerCase() && u.password === loginForm.password),
                totalUsersAtLogin: currentUsers.length,
                source: 'nube'
              };
              
              setLoginAttempts(prev => [attempt, ...prev].slice(0, 10));
              
              console.log('ğŸ¯ Resultado del login:', {
                userFound: user,
                attempt: attempt
              });
              
              if (user) {
                setCurrentUser(user);
                setLoginError('');
                setLoginForm({ username: '', password: '' });
                setCloudStatus('conectado');
                console.log('âœ… Login exitoso para:', user.name);
              } else {
                const errorMsg = `Usuario o contraseÃ±a incorrectos. Usuarios en sistema: ${currentUsers.length} (verificado desde la nube)`;
                setLoginError(errorMsg);
                setCloudStatus('conectado');
                console.log('âŒ Login fallido:', errorMsg);
                
                // Actualizar lista local con datos de la nube
                setUsers(currentUsers);
              }
            } catch (error) {
              console.error('âŒ Error durante login:', error);
              setLoginError('Error conectando con el servidor. Intenta de nuevo.');
              setCloudStatus('error');
            } finally {
              setIsLoading(false);
            }
          };

          // FunciÃ³n de logout
          const handleLogout = () => {
            console.log('ğŸšª Cerrando sesiÃ³n de:', currentUser?.name);
            setCurrentUser(null);
            setLoginForm({ username: '', password: '' });
            setLoginError('');
          };

          // FunciÃ³n para crear usuario con sincronizaciÃ³n en la nube
          const handleCreateUser = async () => {
            if (!newUser.username || !newUser.password || !newUser.name || !newUser.phone) {
              alert('Por favor completa todos los campos');
              return;
            }
            
            setIsLoading(true);
            setCloudStatus('guardando');
            
            try {
              // Obtener usuarios mÃ¡s recientes de la nube
              const currentUsers = await getStoredUsers();
              
              // Verificar usuario duplicado
              if (currentUsers.find(u => u.username.toLowerCase() === newUser.username.toLowerCase())) {
                alert('Este nombre de usuario ya existe');
                setCloudStatus('conectado');
                return;
              }
              
              if (newUser.password.length < 6) {
                alert('La contraseÃ±a debe tener al menos 6 caracteres');
                setCloudStatus('conectado');
                return;
              }
              
              const userToAdd = {
                id: currentUsers.length > 0 ? Math.max(...currentUsers.map(u => u.id)) + 1 : 1,
                username: newUser.username, // MANTENER FORMATO ORIGINAL
                password: newUser.password,
                role: 'user',
                name: newUser.name,
                phone: newUser.phone,
                active: true,
                createdAt: new Date().toISOString()
              };
              
              console.log('â• Creando usuario en la nube:', userToAdd);
              
              // Crear nueva lista y guardar en la nube
              const newUsersList = [...currentUsers, userToAdd];
              
              // Guardar en la nube y esperar confirmaciÃ³n
              const cloudSaved = await saveUsersToStorage(newUsersList);
              
              if (cloudSaved) {
                // Actualizar estado local solo si se guardÃ³ en la nube
                setUsers(newUsersList);
                setCloudStatus('conectado');
                
                console.log('ğŸ“ Usuario creado exitosamente. Total usuarios:', newUsersList.length);
                
                setLastCreatedUser(userToAdd);
                setNewUser({ username: '', password: '', name: '', phone: '' });
                setShowCreateForm(false);
                
                // Alert con credenciales exactas
                alert(`âœ… Usuario creado exitosamente y sincronizado en la nube!

CREDENCIALES EXACTAS PARA COMPARTIR:
ğŸ‘¤ Usuario: ${userToAdd.username}
ğŸ”‘ ContraseÃ±a: ${userToAdd.password}
ğŸ“± Nombre: ${userToAdd.name}
ğŸ“ TelÃ©fono: ${userToAdd.phone}

âš ï¸ IMPORTANTE: 
â€¢ El usuario ya estÃ¡ disponible en TODOS los dispositivos
â€¢ Puede iniciar sesiÃ³n inmediatamente desde cualquier dispositivo
â€¢ Total usuarios en sistema: ${newUsersList.length}
â€¢ Estado: â˜ï¸ Sincronizado en la nube

ğŸ“‹ Comparte estas credenciales exactas con ${userToAdd.name}.`);
                
                // Forzar actualizaciÃ³n del debug
                setLastSync(Date.now());
              } else {
                alert('âŒ Error: No se pudo guardar el usuario en la nube. Verifica tu conexiÃ³n a internet e intenta de nuevo.');
                setCloudStatus('error');
              }
            } catch (error) {
              console.error('âŒ Error creando usuario:', error);
              alert('âŒ Error: No se pudo crear el usuario. Verifica tu conexiÃ³n a internet e intenta de nuevo.');
              setCloudStatus('error');
            } finally {
              setIsLoading(false);
            }
          };

          // FunciÃ³n para copiar credenciales
          const copyCredentials = (user) => {
            const credentials = `Usuario: ${user.username}\nContraseÃ±a: ${user.password}`;
            navigator.clipboard.writeText(credentials).then(() => {
              alert('Credenciales copiadas al portapapeles');
            }).catch(() => {
              // Fallback si no funciona clipboard
              prompt('Copia estas credenciales:', credentials);
            });
          };

          // FunciÃ³n para eliminar usuario
          const handleDeleteUser = async (userId) => {
            if (userId === 1) {
              alert('No puedes eliminar al administrador principal');
              return;
            }
            
            if (window.confirm('Â¿EstÃ¡s seguro de eliminar este usuario?')) {
              setIsLoading(true);
              setCloudStatus('guardando');
              
              try {
                const currentUsers = await getStoredUsers();
                const newUsersList = currentUsers.filter(u => u.id !== userId);
                
                const cloudSaved = await saveUsersToStorage(newUsersList);
                if (cloudSaved) {
                  setUsers(newUsersList);
                  setCloudStatus('conectado');
                  console.log('ğŸ—‘ï¸ Usuario eliminado. Nueva lista:', newUsersList);
                } else {
                  alert('âŒ Error: No se pudo eliminar el usuario en la nube.');
                  setCloudStatus('error');
                }
              } catch (error) {
                console.error('âŒ Error eliminando usuario:', error);
                alert('âŒ Error: No se pudo eliminar el usuario.');
                setCloudStatus('error');
              } finally {
                setIsLoading(false);
              }
            }
          };

          // FunciÃ³n para activar/desactivar usuario
          const toggleUserStatus = async (userId) => {
            if (userId === 1) {
              alert('No puedes desactivar al administrador principal');
              return;
            }
            
            setIsLoading(true);
            setCloudStatus('guardando');
            
            try {
              const currentUsers = await getStoredUsers();
              const newUsersList = currentUsers.map(user => 
                user.id === userId 
                  ? { ...user, active: !user.active }
                  : user
              );
              
              const cloudSaved = await saveUsersToStorage(newUsersList);
              if (cloudSaved) {
                setUsers(newUsersList);
                setCloudStatus('conectado');
                console.log('ğŸ”„ Estado de usuario cambiado:', newUsersList);
              } else {
                alert('âŒ Error: No se pudo cambiar el estado del usuario en la nube.');
                setCloudStatus('error');
              }
            } catch (error) {
              console.error('âŒ Error cambiando estado de usuario:', error);
              alert('âŒ Error: No se pudo cambiar el estado del usuario.');
              setCloudStatus('error');
            } finally {
              setIsLoading(false);
            }
          };

          // FunciÃ³n para editar usuario
          const startEditUser = (user) => {
            setEditingUser({...user, newPassword: ''});
          };

          const saveEditUser = async () => {
            if (!editingUser.name || !editingUser.phone || !editingUser.username) {
              alert('Por favor completa todos los campos obligatorios');
              return;
            }

            if (editingUser.newPassword && editingUser.newPassword.length < 6) {
              alert('La contraseÃ±a debe tener al menos 6 caracteres');
              return;
            }

            setIsLoading(true);
            setCloudStatus('guardando');

            try {
              const currentUsers = await getStoredUsers();
              const existingUser = currentUsers.find(u => 
                u.username.toLowerCase() === editingUser.username.toLowerCase() && 
                u.id !== editingUser.id
              );
              if (existingUser) {
                alert('Este nombre de usuario ya existe');
                setCloudStatus('conectado');
                return;
              }

              const updatedUser = {
                ...editingUser,
                password: editingUser.newPassword || editingUser.password
              };
              delete updatedUser.newPassword;

              const newUsersList = currentUsers.map(user => 
                user.id === editingUser.id ? updatedUser : user
              );
              
              const cloudSaved = await saveUsersToStorage(newUsersList);
              if (cloudSaved) {
                setUsers(newUsersList);
                setCloudStatus('conectado');
                
                // Si el usuario actual estÃ¡ siendo editado, actualizar tambiÃ©n currentUser
                if (currentUser && currentUser.id === editingUser.id) {
                  setCurrentUser(updatedUser);
                }
                
                setEditingUser(null);
                console.log('âœï¸ Usuario editado:', newUsersList);
                alert('Usuario actualizado exitosamente y sincronizado en la nube');
              } else {
                alert('âŒ Error: No se pudo actualizar el usuario en la nube.');
                setCloudStatus('error');
              }
            } catch (error) {
              console.error('âŒ Error editando usuario:', error);
              alert('âŒ Error: No se pudo actualizar el usuario.');
              setCloudStatus('error');
            } finally {
              setIsLoading(false);
            }
          };

          const cancelEdit = () => {
            setEditingUser(null);
          };

          // FunciÃ³n para resetear completamente el sistema
          const resetSystem = async () => {
            if (window.confirm('Â¿EstÃ¡s seguro de que quieres resetear COMPLETAMENTE el sistema? Esto eliminarÃ¡ todos los usuarios excepto el administrador y se sincronizarÃ¡ en TODOS los dispositivos.')) {
              setIsLoading(true);
              setCloudStatus('reseteando');
              
              try {
                const defaultUsers = [
                  {
                    id: 1,
                    username: 'estebango001@gmail.com',
                    password: '8357565Jj.',
                    role: 'admin',
                    name: 'Esteban GÃ³mez',
                    phone: '3218526763',
                    active: true,
                    createdAt: new Date().toISOString()
                  }
                ];
                
                const cloudSaved = await saveUsersToStorage(defaultUsers);
                if (cloudSaved) {
                  setUsers(defaultUsers);
                  setLastCreatedUser(null);
                  setLoginAttempts([]);
                  setCloudStatus('conectado');
                  alert('Sistema reseteado completamente y sincronizado en la nube. Total usuarios: 1 (admin)');
                } else {
                  alert('âŒ Error: No se pudo resetear el sistema en la nube.');
                  setCloudStatus('error');
                }
              } catch (error) {
                console.error('âŒ Error reseteando sistema:', error);
                alert('âŒ Error: No se pudo resetear el sistema.');
                setCloudStatus('error');
              } finally {
                setIsLoading(false);
              }
            }
          };

          // FunciÃ³n para forzar sincronizaciÃ³n manual desde la nube
          const forceSync = async () => {
            setIsLoading(true);
            setCloudStatus('sincronizando');
            
            try {
              const freshUsers = await fetchUsersFromCloud();
              if (freshUsers) {
                setUsers(freshUsers);
                setLastSync(Date.now());
                setCloudStatus('conectado');
                alert(`âœ… SincronizaciÃ³n exitosa desde la nube!\n\nUsuarios cargados: ${freshUsers.length}\nÃšltima actualizaciÃ³n: ${new Date().toLocaleString()}`);
              } else {
                setCloudStatus('error');
                alert('âŒ No se pudo obtener datos desde la nube. Verifica tu conexiÃ³n.');
              }
            } catch (error) {
              console.error('âŒ Error en sincronizaciÃ³n forzada:', error);
              setCloudStatus('error');
              alert('âŒ Error durante la sincronizaciÃ³n forzada.');
            } finally {
              setIsLoading(false);
            }
          };

          // Pantalla de Login
          if (!currentUser) {
            return (
              <div className="login-background">
                <div className="min-h-screen flex flex-col items-center justify-center p-4" style={{background: 'rgba(0, 0, 0, 0.8)'}}>
                  {/* Panel de debug detallado */}
                  {debugMode && (
                    <div className="debug-panel">
                      <div><strong>ğŸ› DEBUG - SISTEMA KOKITO v3 â˜ï¸</strong></div>
                      <hr className="my-2 border-gray-600" />
                      
                      <div><strong>ğŸ“Š Estado del Sistema:</strong></div>
                      <div>â€¢ Total usuarios: {users.length}</div>
                      <div>â€¢ Usuarios activos: {users.filter(u => u.active).length}</div>
                      <div>â€¢ SincronizaciÃ³n nube: {CLOUD_ENABLED ? 'âœ… Habilitada' : 'âŒ No configurada'}</div>
                      <div>â€¢ Estado nube: {(() => {
                        const status = cloudStatus;
                        const icons = {
                          'conectado': 'â˜ï¸ âœ…',
                          'conectando': 'â˜ï¸ ğŸ”„',
                          'verificando': 'â˜ï¸ ğŸ”',
                          'guardando': 'â˜ï¸ ğŸ’¾',
                          'sincronizando': 'â˜ï¸ ğŸ”„',
                          'error': 'â˜ï¸ âŒ',
                          'reseteando': 'â˜ï¸ ğŸ—‘ï¸'
                        };
                        return `${icons[status] || 'â˜ï¸ â“'} ${status}`;
                      })()}</div>
                      <div>â€¢ localStorage: {(() => {
                        try {
                          return localStorage.getItem(STORAGE_KEY) ? 'âœ… OK' : 'âŒ VacÃ­o';
                        } catch {
                          return 'âŒ No disponible';
                        }
                      })()}</div>
                      <div>â€¢ Variable global: {window.kokitoUsers ? 'âœ… OK' : 'âŒ Error'}</div>
                      <div>â€¢ Ãšltima sync: {new Date(lastSync).toLocaleTimeString()}</div>
                      
                      {!CLOUD_ENABLED && (
                        <>
                          <hr className="my-2 border-gray-600" />
                          <div className="text-yellow-400 text-xs">
                            <strong>âš ï¸ ConfiguraciÃ³n de Nube:</strong><br/>
                            Para habilitar sincronizaciÃ³n entre dispositivos:<br/>
                            1. Ve a jsonbin.io y crea una cuenta<br/>
                            2. Crea un bin y copia el ID<br/>
                            3. Genera una API key<br/>
                            4. Reemplaza los valores en el cÃ³digo
                          </div>
                        </>
                      )}
                      
                      <hr className="my-2 border-gray-600" />
                      <div><strong>ğŸ‘¥ Lista de Usuarios (desde la nube):</strong></div>
                      {users.map(user => (
                        <div key={user.id} className="text-xs bg-gray-800 p-2 rounded my-1">
                          <div><strong>{user.name}</strong> ({user.role})</div>
                          <div>User: {user.username}</div>
                          <div>Pass: {user.password}</div>
                          <div>Estado: {user.active ? 'ğŸŸ¢ Activo' : 'ğŸ”´ Inactivo'}</div>
                          {user.createdAt && <div>Creado: {new Date(user.createdAt).toLocaleString()}</div>}
                        </div>
                      ))}
                      
                      {lastCreatedUser && (
                        <>
                          <hr className="my-2 border-gray-600" />
                          <div><strong>ğŸ†• Ãšltimo Usuario Creado:</strong></div>
                          <div className="user-credentials">
                            <div><strong>{lastCreatedUser.name}</strong></div>
                            <div>Usuario: {lastCreatedUser.username}</div>
                            <div>ContraseÃ±a: {lastCreatedUser.password}</div>
                            <button 
                              onClick={() => copyCredentials(lastCreatedUser)}
                              className="bg-green-600 text-white px-2 py-1 rounded text-xs mt-1"
                            >
                              ğŸ“‹ Copiar
                            </button>
                          </div>
                        </>
                      )}
                      
                      {loginAttempts.length > 0 && (
                        <>
                          <hr className="my-2 border-gray-600" />
                          <div><strong>ğŸ” Ãšltimos Intentos de Login:</strong></div>
                          {loginAttempts.slice(0, 5).map((attempt, index) => (
                            <div key={index} className="text-xs bg-gray-800 p-2 rounded my-1">
                              <div>{attempt.time} - {attempt.username}</div>
                              <div>
                                {attempt.success ? 'âœ… Exitoso' : 'âŒ Fallido'}
                              </div>
                              {!attempt.success && (
                                <div>
                                  Usuario existe: {attempt.userFound ? 'âœ…' : 'âŒ'}<br/>
                                  Usuario activo: {attempt.activeUser ? 'âœ…' : 'âŒ'}<br/>
                                  ContraseÃ±a OK: {attempt.passwordMatch ? 'âœ…' : 'âŒ'}<br/>
                                  Usuarios en sistema: {attempt.totalUsersAtLogin || 'N/A'}<br/>
                                  Fuente: {attempt.source || 'local'}
                                </div>
                              )}
                            </div>
                          ))}
                        </>
                      )}
                      
                      <hr className="my-2 border-gray-600" />
                      <div className="space-y-1">
                        <button 
                          onClick={forceSync}
                          disabled={isLoading}
                          className="bg-blue-600 text-white px-2 py-1 rounded text-xs w-full disabled:opacity-50"
                        >
                          {isLoading ? 'ğŸ”„ Sincronizando...' : 'â˜ï¸ Sync desde Nube'}
                        </button>
                        <button 
                          onClick={resetSystem}
                          disabled={isLoading}
                          className="bg-red-600 text-white px-2 py-1 rounded text-xs w-full disabled:opacity-50"
                        >
                          ğŸ—‘ï¸ Reset Completo
                        </button>
                      </div>
                    </div>
                  )}

                  {/* Indicador de estado de la nube */}
                  <div className="mb-4 flex items-center space-x-2 text-sm text-gray-300">
                    <span>Estado de sincronizaciÃ³n:</span>
                    <span className={`px-2 py-1 rounded ${
                      cloudStatus === 'conectado' ? 'bg-green-600' :
                      cloudStatus === 'error' ? 'bg-red-600' :
                      'bg-yellow-600'
                    }`}>
                      {cloudStatus === 'conectado' && 'â˜ï¸ âœ… Sincronizado'}
                      {cloudStatus === 'conectando' && 'â˜ï¸ ğŸ”„ Conectando...'}
                      {cloudStatus === 'verificando' && 'â˜ï¸ ğŸ” Verificando...'}
                      {cloudStatus === 'error' && 'â˜ï¸ âŒ Error de conexiÃ³n'}
                    </span>
                  </div>

                  {/* Pantalla de carga inicial */}
                  {isLoading && (
                    <div className="mb-4 text-center text-white">
                      <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
                      <p className="mt-2">Cargando sistema desde la nube...</p>
                    </div>
                  )}

                  {/* Logo Section */}
                  <div className="mb-8">
                    <div className="w-80 h-40 bg-gradient-to-r from-pink-600 to-purple-600 rounded-lg flex items-center justify-center mb-4">
                      <img 
                        src="motivos/LOGO_KOKITO.png" 
                        alt="KOKITO" 
                        className="w-72 h-36 object-contain"
                        onError={(e) => {
                          e.target.style.display = 'none';
                          e.target.nextSibling.style.display = 'block';
                        }}
                      />
                      <span className="text-white text-4xl font-bold" style={{display: 'none'}}>KOKITO</span>
                    </div>
                  </div>

                  {/* Login Form */}
                  <div className="bg-gray-900 p-8 rounded-lg border-2 border-pink-600 w-full max-w-md">
                    <h2 className="text-white text-2xl font-bold text-center mb-6">
                      Sistema Kokito â˜ï¸
                    </h2>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-white text-sm font-medium mb-2">
                          Usuario
                        </label>
                        <input
                          type="text"
                          value={loginForm.username}
                          onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
                          disabled={isLoading}
                          className="w-full p-3 bg-black border-2 border-pink-600 rounded-lg text-white focus:outline-none focus:border-purple-500 disabled:opacity-50"
                          placeholder="Ingresa tu usuario"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-white text-sm font-medium mb-2">
                          ContraseÃ±a
                        </label>
                        <div className="relative">
                          <input
                            type={showPassword ? "text" : "password"}
                            value={loginForm.password}
                            onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                            onKeyPress={(e) => e.key === 'Enter' && !isLoading && handleLogin()}
                            disabled={isLoading}
                            className="w-full p-3 bg-black border-2 border-pink-600 rounded-lg text-white focus:outline-none focus:border-purple-500 pr-12 disabled:opacity-50"
                            placeholder="Ingresa tu contraseÃ±a"
                          />
                          <button
                            type="button"
                            onClick={() => setShowPassword(!showPassword)}
                            disabled={isLoading}
                            className="absolute right-3 top-3 text-gray-400 hover:text-white disabled:opacity-50"
                          >
                            {showPassword ? <Icons.EyeOff /> : <Icons.Eye />}
                          </button>
                        </div>
                      </div>
                      
                      {loginError && (
                        <div className="text-red-400 text-sm text-center bg-red-900/20 p-2 rounded">
                          {loginError}
                        </div>
                      )}
                      
                      <button
                        onClick={handleLogin}
                        disabled={isLoading || cloudStatus === 'error'}
                        className="w-full bg-gradient-to-r from-pink-600 to-purple-600 text-white py-3 rounded-lg font-medium hover:from-pink-700 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        {isLoading ? (
                          <span className="flex items-center justify-center">
                            <span className="animate-spin mr-2">ğŸ”„</span>
                            Verificando...
                          </span>
                        ) : (
                          'Iniciar SesiÃ³n'
                        )}
                      </button>

                      {/* BotÃ³n de debug */}
                      <button
                        onClick={() => setDebugMode(!debugMode)}
                        className="w-full bg-gray-700 text-white py-2 rounded-lg text-sm"
                      >
                        {debugMode ? 'ğŸ™ˆ Ocultar Debug' : 'ğŸ› Mostrar Debug'}
                      </button>
                      
                      {/* InformaciÃ³n rÃ¡pida */}
                      <div className="text-center text-xs text-gray-400">
                        Usuarios en sistema: {users.length} | Sincronizado: {new Date(lastSync).toLocaleTimeString()}
                        <br />
                        â˜ï¸ Disponible en todos los dispositivos
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // Panel de Administrador
          if (currentUser.role === 'admin') {
            return (
              <div className="system-overlay">
                <div className="min-h-screen text-white">
                  {/* Header */}
                  <header className="bg-gray-900 border-b-2 border-pink-600 p-4">
                    <div className="max-w-6xl mx-auto flex justify-between items-center">
                      <div className="flex items-center space-x-4">
                        <div className="w-12 h-12 bg-gradient-to-r from-pink-600 to-purple-600 rounded-lg flex items-center justify-center">
                          <span className="text-white font-bold text-sm">K</span>
                        </div>
                        <div>
                          <h1 className="text-xl font-bold">Panel de AdministraciÃ³n</h1>
                          <p className="text-gray-400 text-sm">Bienvenido, {currentUser.name}</p>
                        </div>
                      </div>
                      
                      <div className="flex items-center space-x-4">
                        <button
                          onClick={() => setDebugMode(!debugMode)}
                          className="bg-gray-600 hover:bg-gray-700 px-3 py-2 rounded-lg text-sm"
                        >
                          ğŸ› Debug
                        </button>
                        <button
                          onClick={handleLogout}
                          className="flex items-center space-x-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors"
                        >
                          <Icons.LogOut />
                          <span>Cerrar SesiÃ³n</span>
                        </button>
                      </div>
                    </div>
                  </header>

                  {/* Panel de debug para admin */}
                  {debugMode && (
                    <div className="bg-blue-900/30 border border-blue-500 p-4 m-4">
                      <h4 className="font-bold text-blue-300">ğŸ› Panel de Debug - Administrador v3 â˜ï¸</h4>
                      <div className="text-sm mt-2 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <strong>Estado del Sistema:</strong>
                          <div>Total usuarios: {users.length}</div>
                          <div>Estado nube: {(() => {
                            const status = cloudStatus;
                            const icons = {
                              'conectado': 'â˜ï¸ âœ…',
                              'conectando': 'â˜ï¸ ğŸ”„',
                              'verificando': 'â˜ï¸ ğŸ”',
                              'guardando': 'â˜ï¸ ğŸ’¾',
                              'sincronizando': 'â˜ï¸ ğŸ”„',
                              'error': 'â˜ï¸ âŒ',
                              'reseteando': 'â˜ï¸ ğŸ—‘ï¸'
                            };
                            return `${icons[status] || 'â˜ï¸ â“'} ${status}`;
                          })()}</div>
                          <div>localStorage: {(() => {
                            try {
                              return localStorage.getItem(STORAGE_KEY) ? 'âœ… OK' : 'âŒ VacÃ­o';
                            } catch {
                              return 'âŒ No disponible';
                            }
                          })()}</div>
                          <div>Variable global: {window.kokitoUsers ? 'âœ… OK' : 'âŒ Error'}</div>
                          <div>Ãšltimo creado: {lastCreatedUser?.name || 'Ninguno'}</div>
                          <div>Ãšltima sync: {new Date(lastSync).toLocaleTimeString()}</div>
                        </div>
                        <div>
                          <strong>Acciones:</strong>
                          <div className="space-x-2 mt-1">
                            <button 
                              onClick={forceSync}
                              disabled={isLoading}
                              className="bg-blue-600 text-white px-3 py-1 rounded text-xs disabled:opacity-50"
                            >
                              {isLoading ? 'ğŸ”„' : 'â˜ï¸'} Sync Nube
                            </button>
                            <button 
                              onClick={resetSystem}
                              disabled={isLoading}
                              className="bg-red-600 text-white px-3 py-1 rounded text-xs disabled:opacity-50"
                            >
                              ğŸ—‘ï¸ Reset Sistema
                            </button>
                            <button 
                              onClick={() => console.log('Estado completo:', { 
                                stored: users, 
                                global: window.kokitoUsers,
                                sync: lastSync,
                                cloudStatus: cloudStatus
                              })}
                              className="bg-purple-600 text-white px-3 py-1 rounded text-xs"
                            >
                              ğŸ“Š Log Estado
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Indicador de estado en tiempo real */}
                  <div className="max-w-6xl mx-auto px-6 mb-4">
                    <div className="bg-gray-800 border border-gray-700 rounded-lg p-3 flex items-center justify-between">
                      <div className="flex items-center space-x-4">
                        <span className="text-gray-300">Estado de sincronizaciÃ³n:</span>
                        <span className={`px-3 py-1 rounded-full text-sm ${
                          cloudStatus === 'conectado' ? 'bg-green-600 text-white' :
                          cloudStatus === 'error' ? 'bg-red-600 text-white' :
                          'bg-yellow-600 text-black'
                        }`}>
                          {cloudStatus === 'conectado' && 'â˜ï¸ âœ… Sincronizado en todos los dispositivos'}
                          {cloudStatus === 'conectando' && 'â˜ï¸ ğŸ”„ Conectando con la nube...'}
                          {cloudStatus === 'verificando' && 'â˜ï¸ ğŸ” Verificando datos...'}
                          {cloudStatus === 'guardando' && 'â˜ï¸ ğŸ’¾ Guardando cambios...'}
                          {cloudStatus === 'sincronizando' && 'â˜ï¸ ğŸ”„ Sincronizando...'}
                          {cloudStatus === 'error' && 'â˜ï¸ âŒ Error de conexiÃ³n'}
                          {cloudStatus === 'reseteando' && 'â˜ï¸ ğŸ—‘ï¸ Reseteando sistema...'}
                        </span>
                      </div>
                      <div className="text-gray-400 text-sm">
                        Usuarios: {users.length} | Ãšltima actualizaciÃ³n: {new Date(lastSync).toLocaleString()}
                      </div>
                    </div>
                  </div>

                  {/* Overlay de carga */}
                  {isLoading && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                      <div className="bg-gray-900 border-2 border-pink-600 rounded-lg p-6 text-center">
                        <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-pink-600 mb-4"></div>
                        <p className="text-white">
                          {cloudStatus === 'conectando' && 'Conectando con la nube...'}
                          {cloudStatus === 'verificando' && 'Verificando credenciales...'}
                          {cloudStatus === 'guardando' && 'Guardando cambios en la nube...'}
                          {cloudStatus === 'sincronizando' && 'Sincronizando datos...'}
                          {cloudStatus === 'reseteando' && 'Reseteando sistema...'}
                        </p>
                      </div>
                    </div>
                  )}

                  <div className="max-w-6xl mx-auto p-6">
                    {/* EstadÃ­sticas */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                      <div className="bg-gray-900 border-2 border-pink-600 rounded-lg p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-gray-400 text-sm">Total Usuarios</p>
                            <p className="text-2xl font-bold">{users.filter(u => u.role === 'user').length}</p>
                          </div>
                          <div className="text-pink-600 text-3xl">
                            <Icons.User />
                          </div>
                        </div>
                      </div>
                      
                      <div className="bg-gray-900 border-2 border-purple-600 rounded-lg p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-gray-400 text-sm">Usuarios Activos</p>
                            <p className="text-2xl font-bold">{users.filter(u => u.active).length}</p>
                          </div>
                          <div className="text-purple-600 text-3xl">
                            <Icons.Settings />
                          </div>
                        </div>
                      </div>
                      
                      <div className="bg-gray-900 border-2 border-blue-600 rounded-lg p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-gray-400 text-sm">Total Sistema</p>
                            <p className="text-2xl font-bold">{users.length}</p>
                          </div>
                          <div className="text-blue-600 text-3xl">
                            <Icons.UserPlus />
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* BotÃ³n Crear Usuario */}
                    <div className="mb-6">
                      <button
                        onClick={() => setShowCreateForm(!showCreateForm)}
                        disabled={isLoading}
                        className="bg-gradient-to-r from-pink-600 to-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:from-pink-700 hover:to-purple-700 transition-all duration-300 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        <Icons.UserPlus />
                        <span>{isLoading ? 'Procesando...' : 'Crear Nuevo Usuario'}</span>
                      </button>
                    </div>

                    {/* Mostrar Ãºltimo usuario creado */}
                    {lastCreatedUser && (
                      <div className="bg-green-900/20 border-2 border-green-600 rounded-lg p-4 mb-6">
                        <h4 className="text-green-400 font-bold flex items-center space-x-2">
                          <span>ğŸ‰</span>
                          <span>Ãšltimo Usuario Creado</span>
                        </h4>
                        <div className="user-credentials mt-2">
                          <div><strong>Nombre:</strong> {lastCreatedUser.name}</div>
                          <div><strong>Usuario:</strong> {lastCreatedUser.username}</div>
                          <div><strong>ContraseÃ±a:</strong> {lastCreatedUser.password}</div>
                          <div><strong>TelÃ©fono:</strong> {lastCreatedUser.phone}</div>
                          <div className="mt-2">
                            <button 
                              onClick={() => copyCredentials(lastCreatedUser)}
                              className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm flex items-center space-x-2"
                            >
                              <Icons.Copy />
                              <span>Copiar Credenciales</span>
                            </button>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Formulario Crear Usuario */}
                    {showCreateForm && (
                      <div className="bg-gray-900 border-2 border-pink-600 rounded-lg p-6 mb-8">
                        <h3 className="text-xl font-bold mb-4">Crear Nuevo Colaborador</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium mb-2">Nombre Completo</label>
                            <input
                              type="text"
                              value={newUser.name}
                              onChange={(e) => setNewUser({...newUser, name: e.target.value})}
                              className="w-full p-3 bg-black border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-600"
                              placeholder="Ej: Juan PÃ©rez"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium mb-2">TelÃ©fono</label>
                            <input
                              type="tel"
                              value={newUser.phone}
                              onChange={(e) => setNewUser({...newUser, phone: e.target.value})}
                              className="w-full p-3 bg-black border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-600"
                              placeholder="Ej: 3001234567"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium mb-2">Usuario (Email)</label>
                            <input
                              type="email"
                              value={newUser.username}
                              onChange={(e) => setNewUser({...newUser, username: e.target.value})}
                              className="w-full p-3 bg-black border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-600"
                              placeholder="Ej: correo@ejemplo.com"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium mb-2">ContraseÃ±a</label>
                            <input
                              type="password"
                              value={newUser.password}
                              onChange={(e) => setNewUser({...newUser, password: e.target.value})}
                              className="w-full p-3 bg-black border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-600"
                              placeholder="MÃ­nimo 6 caracteres"
                            />
                          </div>
                          
                          <div className="md:col-span-2 flex space-x-4">
                            <button
                              onClick={handleCreateUser}
                              disabled={isLoading}
                              className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                              {isLoading ? (
                                <span className="flex items-center">
                                  <span className="animate-spin mr-2">ğŸ”„</span>
                                  Creando...
                                </span>
                              ) : (
                                'Crear Usuario'
                              )}
                            </button>
                            <button
                              onClick={() => setShowCreateForm(false)}
                              disabled={isLoading}
                              className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50"
                            >
                              Cancelar
                            </button>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Lista de Usuarios */}
                    <div className="bg-gray-900 border-2 border-pink-600 rounded-lg overflow-hidden">
                      <div className="bg-pink-600 p-4">
                        <h3 className="text-xl font-bold">Usuarios del Sistema</h3>
                      </div>
                      
                      <div className="p-6">
                        <div className="space-y-4">
                          {users.map(user => (
                            <div key={user.id} className="bg-black border border-gray-700 rounded-lg p-4">
                              {editingUser && editingUser.id === user.id ? (
                                // Modo ediciÃ³n
                                <div className="space-y-4">
                                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                      <label className="block text-sm font-medium mb-2">Nombre</label>
                                      <input
                                        type="text"
                                        value={editingUser.name}
                                        onChange={(e) => setEditingUser({...editingUser, name: e.target.value})}
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
                                      />
                                    </div>
                                    <div>
                                      <label className="block text-sm font-medium mb-2">TelÃ©fono</label>
                                      <input
                                        type="tel"
                                        value={editingUser.phone}
                                        onChange={(e) => setEditingUser({...editingUser, phone: e.target.value})}
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
                                      />
                                    </div>
                                    <div>
                                      <label className="block text-sm font-medium mb-2">Usuario</label>
                                      <input
                                        type="text"
                                        value={editingUser.username}
                                        onChange={(e) => setEditingUser({...editingUser, username: e.target.value})}
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
                                      />
                                    </div>
                                    <div>
                                      <label className="block text-sm font-medium mb-2">Nueva ContraseÃ±a (opcional)</label>
                                      <input
                                        type="password"
                                        value={editingUser.newPassword || ''}
                                        onChange={(e) => setEditingUser({...editingUser, newPassword: e.target.value})}
                                        className="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
                                        placeholder="Dejar vacÃ­o para mantener actual"
                                      />
                                    </div>
                                  </div>
                                  <div className="flex space-x-2">
                                    <button
                                      onClick={saveEditUser}
                                      className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2"
                                    >
                                      <Icons.Save />
                                      <span>Guardar</span>
                                    </button>
                                    <button
                                      onClick={cancelEdit}
                                      className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2"
                                    >
                                      <Icons.Cancel />
                                      <span>Cancelar</span>
                                    </button>
                                  </div>
                                </div>
                              ) : (
                                // Modo visualizaciÃ³n
                                <div className="flex justify-between items-center">
                                  <div className="flex items-center space-x-4">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${
                                      user.role === 'admin' ? 'bg-red-600' : user.active ? 'bg-blue-600' : 'bg-gray-600'
                                    }`}>
                                      {user.name.charAt(0).toUpperCase()}
                                    </div>
                                    <div>
                                      <h4 className="font-medium">{user.name}</h4>
                                      <p className="text-gray-400 text-sm">Usuario: {user.username}</p>
                                      <p className="text-gray-400 text-sm">ContraseÃ±a: {user.password}</p>
                                      <p className="text-gray-400 text-sm">TelÃ©fono: {user.phone}</p>
                                      <div className="flex items-center space-x-2">
                                        <span className={`inline-block px-2 py-1 rounded text-xs ${
                                          user.role === 'admin' ? 'bg-red-600' : 'bg-blue-600'
                                        } text-white`}>
                                          {user.role === 'admin' ? 'Administrador' : 'Colaborador'}
                                        </span>
                                        <span className={`inline-block px-2 py-1 rounded text-xs ${
                                          user.active ? 'bg-green-600' : 'bg-red-600'
                                        } text-white`}>
                                          {user.active ? 'Activo' : 'Inactivo'}
                                        </span>
                                        {user.createdAt && (
                                          <span className="inline-block px-2 py-1 rounded text-xs bg-gray-600 text-white">
                                            {new Date(user.createdAt).toLocaleDateString()}
                                          </span>
                                        )}
                                      </div>
                                    </div>
                                  </div>
                                  
                                  <div className="flex space-x-2 flex-wrap">
                                    <button
                                      onClick={() => copyCredentials(user)}
                                      className="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-1"
                                    >
                                      <Icons.Copy />
                                      <span>Copiar</span>
                                    </button>
                                    
                                    <button
                                      onClick={() => startEditUser(user)}
                                      className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center space-x-1"
                                    >
                                      <Icons.Edit />
                                      <span>Editar</span>
                                    </button>
                                    
                                    {user.role !== 'admin' && (
                                      <>
                                        <button
                                          onClick={() => toggleUserStatus(user.id)}
                                          className={`${user.active ? 'bg-orange-600 hover:bg-orange-700' : 'bg-green-600 hover:bg-green-700'} text-white px-3 py-2 rounded-lg transition-colors`}
                                        >
                                          {user.active ? 'Desactivar' : 'Activar'}
                                        </button>
                                        
                                        <button
                                          onClick={() => handleDeleteUser(user.id)}
                                          className="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg transition-colors"
                                        >
                                          Eliminar
                                        </button>
                                      </>
                                    )}
                                  </div>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // Panel de Usuario Regular
          return (
            <div className="system-overlay">
              <div className="min-h-screen text-white">
                {/* Header */}
                <header className="bg-gray-900 border-b-2 border-pink-600 p-4">
                  <div className="max-w-4xl mx-auto flex justify-between items-center">
                    <div className="flex items-center space-x-4">
                      <div className="w-12 h-12 bg-gradient-to-r from-pink-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <span className="text-white font-bold text-sm">K</span>
                      </div>
                      <div>
                        <h1 className="text-xl font-bold">Sistema Kokito</h1>
                        <p className="text-gray-400 text-sm">Bienvenido, {currentUser.name}</p>
                      </div>
                    </div>
                    
                    <button
                      onClick={handleLogout}
                      className="flex items-center space-x-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors"
                    >
                      <Icons.LogOut />
                      <span>Cerrar SesiÃ³n</span>
                    </button>
                  </div>
                </header>

                <div className="max-w-4xl mx-auto p-6">
                  {/* InformaciÃ³n del Usuario */}
                  <div className="bg-gray-900 border-2 border-pink-600 rounded-lg p-6 mb-8">
                    <h2 className="text-xl font-bold mb-4">Mi InformaciÃ³n</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <p className="text-gray-400 text-sm">Nombre</p>
                        <p className="text-lg font-medium">{currentUser.name}</p>
                      </div>
                      <div>
                        <p className="text-gray-400 text-sm">TelÃ©fono</p>
                        <p className="text-lg font-medium">{currentUser.phone}</p>
                      </div>
                      <div>
                        <p className="text-gray-400 text-sm">Usuario</p>
                        <p className="text-lg font-medium">{currentUser.username}</p>
                      </div>
                      <div>
                        <p className="text-gray-400 text-sm">Estado</p>
                        <span className="inline-block px-3 py-1 rounded-full text-sm bg-green-600 text-white">
                          Activo
                        </span>
                      </div>
                    </div>
                  </div>

                  {/* Botones de AcciÃ³n */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {/* Solicitud de Inventario */}
                    <div 
                      onClick={() => window.location.href = 'pedidos.html'}
                      className="bg-gray-900 border-2 border-blue-600 rounded-lg p-8 text-center hover:bg-gray-800 transition-colors cursor-pointer"
                    >
                      <div className="text-blue-600 text-6xl mb-4 flex justify-center">
                        <Icons.Package />
                      </div>
                      <h3 className="text-xl font-bold mb-2">Solicitud de Inventario</h3>
                      <p className="text-gray-400 mb-4">Realiza solicitudes de productos e inventario</p>
                      <div className="bg-blue-600/20 text-blue-400 px-4 py-2 rounded-lg text-sm">
                        Hacer solicitud
                      </div>
                    </div>

                    {/* Ventas del DÃ­a */}
                    <div className="bg-gray-900 border-2 border-green-600 rounded-lg p-8 text-center hover:bg-gray-800 transition-colors cursor-pointer">
                      <div className="text-green-600 text-6xl mb-4 flex justify-center">
                        <Icons.TrendingUp />
                      </div>
                      <h3 className="text-xl font-bold mb-2">Ventas del DÃ­a</h3>
                      <p className="text-gray-400 mb-4">Registra y consulta las ventas diarias</p>
                      <div className="bg-green-600/20 text-green-400 px-4 py-2 rounded-lg text-sm">
                        PrÃ³ximamente disponible
                      </div>
                    </div>
                  </div>

                  {/* InformaciÃ³n Adicional */}
                  <div className="mt-8 bg-gradient-to-r from-pink-600/20 to-purple-600/20 border border-pink-600 rounded-lg p-6">
                    <h4 className="font-bold mb-2">ğŸ“‹ InformaciÃ³n Importante</h4>
                    <ul className="text-sm text-gray-300 space-y-1">
                      <li>â€¢ Tus datos estÃ¡n pre-configurados para solicitudes rÃ¡pidas</li>
                      <li>â€¢ Las funciones se activarÃ¡n prÃ³ximamente segÃºn configuraciÃ³n</li>
                      <li>â€¢ Contacta al administrador para soporte tÃ©cnico</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Renderizar la aplicaciÃ³n
        ReactDOM.render(React.createElement(KokitoSystem), document.getElementById('root'));
    </script>
</body>
</html>
